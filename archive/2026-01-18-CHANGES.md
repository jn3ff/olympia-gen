# Changes Plan

- [x] Fix jump limits: initialize `MovementState.air_jumps_remaining` from `MovementTuning::max_air_jumps` on spawn, and ensure `detect_ground` only counts ground colliders (filter raycasts to `Ground`) so enemies/portals do not reset jumps. Verify `apply_jump` consumes coyote time and air jumps once per press, and add short-term logging of `on_ground`/`air_jumps_remaining` to confirm the fix. Target files: `src/movement/mod.rs`.
- [x] Make walls solid and tame knockback: verify wall/ground colliders in `spawn_room_geometry` and arena setup are not sensors and have the right collision layers; if avian2d layers are required, add explicit `CollisionLayers` for world vs. actors. Clamp or scale knockback in `apply_knockback` (or use impulses) and add damping so enemies do not accumulate extreme velocity. Target files: `src/rooms/mod.rs`, `src/combat/mod.rs`.
- [x] Stabilize arena to room transitions: gate `detect_exit_collision` so it only reacts to exits marked `PortalEnabled`, drain stale collision events on state changes, and enforce `TransitionCooldown` before both arena and room transitions. Ensure player spawn positions do not overlap exit sensors, and add temporary logging around `RoomGraph.pending_transition` and `RunState` changes to catch double-fires. Target file: `src/rooms/mod.rs`.
- [x] Make portal enablement configurable per room and exit: extend `RoomData` (or a new `RoomExitConfig`) to carry a `PortalEnableCondition` spec (always enabled, no enemies remaining, composite all/any, or custom closure). When spawning exits, attach the chosen condition and set initial `PortalDisabled` or `PortalEnabled`, and let `evaluate_portal_conditions` drive visuals and interaction for all exits (not just left/up). Target file: `src/rooms/mod.rs`.
- [x] Fix portal exit fall-through and add confirm-to-enter UX: ensure exit portals always render with a visible, stand-on-able surface (no jump required) by adding a solid collider/floor at portal height, and keep the sensor for interaction separate if needed. Add a "Press [E] to enter" tooltip that appears on contact and require a confirm key to trigger `ExitRoomEvent` so accidental falls do not instantly transition. Target files: `src/rooms/mod.rs`, `src/ui/mod.rs` (if a shared tooltip UI helper exists).
